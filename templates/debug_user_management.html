<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug User Management - News Digest</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: #f5f7fa;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: #f8fafc;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .test-section h3 {
            margin-top: 0;
            color: #4a5568;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }
        .btn-success {
            background: #38a169;
            color: white;
        }
        .btn-success:hover {
            background: #2f855a;
        }
        .btn-danger {
            background: #e53e3e;
            color: white;
        }
        .btn-danger:hover {
            background: #c53030;
        }
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        .btn-secondary:hover {
            background: #cbd5e0;
        }
        .console-output {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            font-size: 13px;
            line-height: 1.4;
        }
        .log-line {
            margin: 2px 0;
            padding: 2px 0;
        }
        .log-success { color: #68d391; }
        .log-error { color: #fc8181; }
        .log-warning { color: #f6e05e; }
        .log-info { color: #63b3ed; }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-good { background: #38a169; }
        .status-bad { background: #e53e3e; }
        .status-unknown { background: #a0aec0; }
        .test-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .simulated-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .simulated-table th,
        .simulated-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e2e8f0;
        }
        .simulated-table th {
            background: #f8fafc;
            font-weight: 600;
        }
        .simulated-table tr:hover {
            background: #f8fafc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ User Management Debug Console</h1>
        
        <div class="test-section">
            <h3>üîç Function Availability Test</h3>
            <div class="test-buttons">
                <button onclick="testFunctionAvailability()" class="btn-primary">Test All Functions</button>
                <button onclick="clearConsole()" class="btn-secondary">Clear Console</button>
                <button onclick="testEventDelegation()" class="btn-success">Test Event Delegation</button>
                <button onclick="simulateErrors()" class="btn-danger">Simulate Error Conditions</button>
            </div>
            <div class="console-output" id="debugConsole">
                <div class="log-line log-info">üöÄ Debug console initialized. Click 'Test All Functions' to start...</div>
            </div>
        </div>

        <div class="test-section">
            <h3>üéØ Simulated User Management Buttons</h3>
            <p>These buttons use the same data attributes as the real user management page:</p>
            <table class="simulated-table">
                <thead>
                    <tr>
                        <th>User ID</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>test_user_1</strong></td>
                        <td>
                            <button data-action="send-email" data-user-id="test_user_1" class="btn-success btn-sm">üì§ Send</button>
                            <button data-action="edit-user" data-user-id="test_user_1" class="btn-secondary btn-sm">‚úèÔ∏è Edit</button>
                            <button data-action="delete-user" data-user-id="test_user_1" class="btn-danger btn-sm">üóëÔ∏è Delete</button>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>test_user_2</strong></td>
                        <td>
                            <button data-action="send-email" data-user-id="test_user_2" class="btn-success btn-sm">üì§ Send</button>
                            <button data-action="edit-user" data-user-id="test_user_2" class="btn-secondary btn-sm">‚úèÔ∏è Edit</button>
                            <button data-action="delete-user" data-user-id="test_user_2" class="btn-danger btn-sm">üóëÔ∏è Delete</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="test-section">
            <h3>üìä Real-time Status Monitor</h3>
            <div id="statusMonitor">
                <div><span class="status-indicator status-unknown"></span><span id="functionStatus">Functions: Unknown</span></div>
                <div><span class="status-indicator status-unknown"></span><span id="eventStatus">Event Listeners: Unknown</span></div>
                <div><span class="status-indicator status-unknown"></span><span id="domStatus">DOM: Unknown</span></div>
            </div>
        </div>
    </div>

    <!-- Delete Modal (same as real page) -->
    <div id="deleteModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
        <div style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 8px; width: 300px;">
            <h3>üóëÔ∏è Confirm Deletion</h3>
            <p>Are you sure you want to delete user <strong id="deleteUserName"></strong>?</p>
            <div style="text-align: right; margin-top: 20px;">
                <button data-action="close-modal" data-modal-id="deleteModal" class="btn-secondary">Cancel</button>
                <button data-action="confirm-delete" class="btn-danger" id="confirmDeleteBtn">Delete User</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables (same as real page)
        let userToDelete = null;

        // Logging utility
        function addLog(message, type = 'info') {
            const console = document.getElementById('debugConsole');
            const logLine = document.createElement('div');
            logLine.className = `log-line log-${type}`;
            const timestamp = new Date().toLocaleTimeString();
            logLine.innerHTML = `[${timestamp}] ${message}`;
            console.appendChild(logLine);
            console.scrollTop = console.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('debugConsole').innerHTML = '';
            addLog('üßπ Console cleared', 'info');
        }

        function updateStatus(elementId, status, isGood) {
            const element = document.getElementById(elementId);
            const indicator = element.previousElementSibling;
            element.textContent = status;
            indicator.className = `status-indicator ${isGood ? 'status-good' : 'status-bad'}`;
        }

        function testFunctionAvailability() {
            addLog('üîç Testing function availability...', 'info');
            
            const functions = ['handleSendEmail', 'handleEditUser', 'handleDeleteUser', 'handleConfirmDelete', 'handleCloseModal'];
            let allAvailable = true;
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    addLog(`‚úÖ ${funcName} is available`, 'success');
                } else {
                    addLog(`‚ùå ${funcName} is NOT available`, 'error');
                    allAvailable = false;
                }
            });
            
            updateStatus('functionStatus', allAvailable ? 'Functions: All Available' : 'Functions: Missing', allAvailable);
            
            // Test event listeners
            const hasListeners = document.onclick !== null || document.addEventListener !== undefined;
            updateStatus('eventStatus', hasListeners ? 'Event Listeners: Active' : 'Event Listeners: None', hasListeners);
            
            // Test DOM
            const domReady = document.readyState === 'complete';
            updateStatus('domStatus', `DOM: ${document.readyState}`, domReady);
            
            addLog(allAvailable ? '‚úÖ All functions are available!' : '‚ùå Some functions are missing!', allAvailable ? 'success' : 'error');
        }

        function testEventDelegation() {
            addLog('üéØ Testing event delegation...', 'info');
            
            // Simulate clicking each button type
            const testButton = document.createElement('button');
            testButton.setAttribute('data-action', 'test-action');
            testButton.setAttribute('data-user-id', 'test-user');
            
            const event = new MouseEvent('click', {
                bubbles: true,
                cancelable: true,
                view: window
            });
            
            Object.defineProperty(event, 'target', { value: testButton });
            
            try {
                document.dispatchEvent(event);
                addLog('‚úÖ Event delegation is working', 'success');
            } catch (error) {
                addLog(`‚ùå Event delegation failed: ${error.message}`, 'error');
            }
        }

        function simulateErrors() {
            addLog('üí• Simulating error conditions...', 'warning');
            
            // Test with missing data attributes
            try {
                const badButton = document.createElement('button');
                const event = new MouseEvent('click', { bubbles: true });
                Object.defineProperty(event, 'target', { value: badButton });
                document.dispatchEvent(event);
                addLog('‚úÖ Handled missing data attributes gracefully', 'success');
            } catch (error) {
                addLog(`‚ùå Failed to handle missing data attributes: ${error.message}`, 'error');
            }
        }

        // Copy the exact same event delegation logic from the real page
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üöÄ DOM loaded, setting up event listeners...', 'info');
            
            // Setup event delegation for user action buttons
            document.addEventListener('click', function(event) {
                const target = event.target;
                const action = target.getAttribute('data-action');
                const userId = target.getAttribute('data-user-id');
                const modalId = target.getAttribute('data-modal-id');
                
                if (action) {
                    addLog(`üéØ Click detected: action=${action}, userId=${userId}, modalId=${modalId}`, 'info');
                    
                    switch(action) {
                        case 'send-email':
                            addLog(`üìß Would send email to ${userId}`, 'success');
                            if (typeof handleSendEmail === 'function') {
                                // Don't actually call it to avoid API calls
                                addLog('‚úÖ handleSendEmail function is available', 'success');
                            } else {
                                addLog('‚ùå handleSendEmail function not found', 'error');
                            }
                            break;
                        case 'edit-user':
                            addLog(`‚úèÔ∏è Would edit user ${userId}`, 'success');
                            if (typeof handleEditUser === 'function') {
                                addLog('‚úÖ handleEditUser function is available', 'success');
                            } else {
                                addLog('‚ùå handleEditUser function not found', 'error');
                            }
                            break;
                        case 'delete-user':
                            addLog(`üóëÔ∏è Would delete user ${userId}`, 'warning');
                            userToDelete = userId;
                            const modal = document.getElementById('deleteModal');
                            const nameElement = document.getElementById('deleteUserName');
                            if (modal && nameElement) {
                                nameElement.textContent = userId;
                                modal.style.display = 'block';
                                addLog('‚úÖ Modal opened successfully', 'success');
                            } else {
                                addLog('‚ùå Modal elements not found', 'error');
                            }
                            break;
                        case 'confirm-delete':
                            addLog(`‚ö†Ô∏è Would confirm delete for ${userToDelete}`, 'warning');
                            document.getElementById('deleteModal').style.display = 'none';
                            userToDelete = null;
                            break;
                        case 'close-modal':
                            addLog(`üö™ Closing modal ${modalId}`, 'info');
                            document.getElementById(modalId).style.display = 'none';
                            break;
                        default:
                            addLog(`‚ùì Unknown action: ${action}`, 'warning');
                    }
                } else if (target.tagName === 'BUTTON') {
                    addLog('üîç Button click detected but no data-action attribute', 'warning');
                }
            });
            
            addLog('‚úÖ Event listeners setup complete!', 'success');
            
            // Initial status check
            setTimeout(testFunctionAvailability, 500);
        });

        // Define functions globally for testing (same as real page should have)
        window.handleSendEmail = function(userId, btn) {
            addLog(`handleSendEmail called with userId: ${userId}`, 'info');
        };

        window.handleEditUser = function(userId) {
            addLog(`handleEditUser called with userId: ${userId}`, 'info');
        };

        window.handleDeleteUser = function(userId) {
            addLog(`handleDeleteUser called with userId: ${userId}`, 'info');
        };

        window.handleConfirmDelete = function(btn) {
            addLog(`handleConfirmDelete called`, 'info');
        };

        window.handleCloseModal = function(modalId) {
            addLog(`handleCloseModal called with modalId: ${modalId}`, 'info');
        };
    </script>
</body>
</html>