# News Digest Generator 📰

A comprehensive news aggregation platform with CLI tools and modern web interface that fetches articles from RSS feeds, processes them with AI, and generates personalized digests.

## Quick Start

### CLI Usage
```bash
# 1. First-time setup
python main.py setup

# 2. Add a user
python main.py user add your-email@example.com

# 3. Run complete pipeline (collect, process, email digest)
python main.py run your-user-id

# 4. Preview digest without sending email
python main.py preview your-user-id --format html

# 5. Start web interface
python main.py web
```

### Email Setup
The system supports comprehensive email delivery with:
- **Responsive HTML emails** with mobile-friendly design
- **Personalized subject lines** generated by AI
- **Interactive feedback buttons** (Like/Dislike/More Like This)
- **Social sharing integration** (Twitter, LinkedIn, WhatsApp)
- **Engagement tracking** and analytics

Configure email in `config.py` with your SMTP settings.

## 🌟 Features Overview

### Core Features
- 📡 **RSS Feed Collection**: Aggregates news from 50+ curated RSS feeds across 10 categories
- 🤖 **Multi-AI Processing**: Supports OpenAI, Anthropic Claude, and Google AI with automatic fallback
- 🎯 **Personalization**: User preferences for categories, digest length, and output format
- 📊 **Trend Detection**: Identifies and highlights trending topics across articles
- 🔄 **Smart Deduplication**: Advanced duplicate detection with content hashing and incremental updates
- 📄 **Multiple Formats**: Outputs in text, Markdown, or email-ready formats
- 👍 **Feedback System**: Users can rate articles to improve future recommendations

### 🆕 Latest Major Enhancements

#### 🌐 **Professional Web Interface**
- **Modern Glassmorphism Design**: Frosted glass navigation with backdrop blur effects
- **Interactive Dashboard**: Beautiful cards, smooth animations, and responsive layout
- **Mobile-First Design**: Fully responsive across all devices with touch-friendly UI
- **Real-time Operations**: Live pipeline execution, status monitoring, and feedback
- **Advanced Typography**: Professional Inter font with proper weight hierarchy

#### ⚙️ **Operations Dashboard**
- **Pipeline Management**: Run full news processing pipelines from the web interface
- **Email Integration**: Send digest emails directly from the browser
- **System Monitoring**: Real-time statistics and health checks
- **Bulk Operations**: Multi-user management and batch processing
- **Background Processing**: Long-running tasks with progress tracking

#### 👥 **User Management System**
- **Visual User Directory**: Searchable table with category pills and status indicators
- **Bulk Operations**: Export users, send mass emails, perform bulk edits
- **Interactive Forms**: Beautiful category selection with visual feedback
- **CSV Export**: Download user data for external analysis
- **Delete Confirmation**: Modal dialogs with safety confirmations

#### 🎨 **Enhanced UI/UX**
- **Professional Color System**: CSS custom properties with gradient combinations
- **Smooth Animations**: Cubic-bezier transitions, hover effects, and loading states
- **Status Badge System**: Color-coded indicators for success, error, warning, and info
- **Icon Integration**: FontAwesome 6.4.0 throughout the interface
- **Glass Effects**: Semi-transparent elements with backdrop filters

#### 🔧 **Technical Improvements**
- **API Call Optimization**: 10× reduction in API costs through batch processing
- **One-liner Generation**: Daily category-specific insights with database storage
- **Enhanced Error Handling**: Comprehensive logging and user-friendly error messages
- **Debug Endpoints**: Built-in troubleshooting tools and status monitoring
- **Real-time Pipeline Monitoring**: Live logs and progress tracking during execution
- **Smart Rate Limiting**: Automatic AI skipping when API limits are reached

## 🌐 Web Interface Guide

### Getting Started with the Web Interface

#### 1. **Start the Web Interface**
```bash
# Navigate to your project directory
cd my_custom_news_app

# Start the web server
python main.py web
```
The interface will be available at: **http://localhost:5000**

#### 2. **Web Interface Overview**

##### 🏠 **Dashboard** (`/`)
- **User Overview**: View all users with their preferences and digest history
- **Quick Actions**: Fast access to view digests, send emails, or manage users
- **System Status**: See total users, articles, and recent activity

##### 👥 **User Management** (`/user-management`)
- **Add New Users**: Create users with category preferences and email settings
- **Edit Preferences**: Modify existing user categories and settings
- **Bulk Operations**: Export user data or perform batch actions
- **Delete Users**: Remove users with confirmation dialogs

##### ⚙️ **Operations Dashboard** (`/operations`)
This is where the enhanced pipeline features are located:

**🔄 Run News Pipeline**
1. **Select User**: Choose from dropdown of existing users
2. **Configure Options**:
   - ☑️ **Daily digest**: Generate daily format
   - ☑️ **Weekly digest**: Generate weekly format
   - ☑️ **Enhanced AI processing**: Use advanced AI features
   - ☑️ **Dry run**: Preview what would happen without execution
   - ☑️ **Skip AI if rate limited**: Continue without AI when API limits reached ⭐
   - ☑️ **Use existing articles**: Skip RSS collection, use database content
3. **Set Max Articles**: Control articles per RSS feed (default: 10)
4. **Click "🚀 Run Pipeline"**

**📊 Real-Time Monitoring** (appears after starting pipeline):
- **Current Step Display**: Shows exactly what's happening (e.g., "Collecting articles from RSS feeds")
- **Live Log Terminal**: Real-time output with color-coded status
- **Auto-Refresh**: Updates every 5 seconds automatically
- **Progress Indicators**: Visual status with emojis and colors
- **Clear Logs**: Reset display for next run

**📧 Send Email Digest**
- Select user and send digest emails using existing articles
- Real-time feedback on delivery status

**📊 System Monitoring**
- Live statistics: user count, article count, recent deliveries
- Refresh button for latest data

#### 3. **Understanding "Skip AI if Rate Limited"**

When you select **"Skip AI if rate limited"** option:

✅ **What WILL happen**:
- RSS feeds are collected (new articles fetched)
- Articles are stored in database
- Existing AI-processed articles are used for digest
- Email is sent with available content
- User receives digest with mix of new and existing articles

❌ **What will NOT happen**:
- No new AI processing if rate limits are hit
- New articles may have basic summaries instead of AI summaries
- Trending detection may be skipped

**💡 This option ensures users always get emails even when AI APIs are limited!**

#### 4. **Real-Time Pipeline Monitoring**

When you run a pipeline, you'll see:

```
Current Step: 📊 Collecting articles from RSS feeds

🚀 Starting pipeline for user RPant
📝 Command: python3 main.py run --user RPant --skip-ai --max-articles 5
⚡ Starting pipeline execution at 14:30:25
⚡ Step 1: Collecting latest articles...
📝 Max articles per feed: 5
📂 Processing 11 categories with 33 feeds
✅ Collected 15 articles (10 new, 5 updated)
⏭️ Skipping AI processing (--skip-ai flag)
📰 Step 3: Generating digest for user: RPant
📊 Prepared digest with 15 articles across 3 categories
📧 Sending digest email...
✅ Pipeline completed! Email sent to user@example.com
🎉 All steps completed successfully!
```

#### 5. **Troubleshooting Web Interface**

**🔍 Common Issues**:

1. **Real-time logs not showing**:
   - Refresh the page and try again
   - Check browser console for JavaScript errors
   - Ensure pipeline is actually running

2. **Email delivery fails**:
   - Check `.env` file for correct SMTP settings
   - Verify email credentials are properly quoted
   - Look at pipeline logs for specific error messages

3. **Pipeline times out**:
   - RSS collection can take 2-5 minutes
   - Use `--max-articles 3` for faster testing
   - Check internet connection for RSS feed access

**📊 Debug Features**:
- Pipeline logs show detailed error information
- Status indicators use color coding (green=success, red=error, yellow=warning)
- Hover over buttons and cards for additional information

### 🎯 Best Practices for Web Interface

1. **Start Small**: Use `--max-articles 3` for testing
2. **Monitor Resources**: RSS collection is network-intensive
3. **Use Skip AI**: When testing or when you hit rate limits
4. **Check Logs**: Always review real-time logs for issues
5. **Backup Users**: Export user data regularly via user management
- **Config-Driven Models**: Flexible AI model selection from configuration

## 🚀 Quick Start

### 1. Installation

```bash
# Clone or download the application
cd my_custom_news_app

# Install dependencies
pip install -r requirements.txt

# Set up environment variables
cp .env.example .env
# Edit .env and add your AI service API keys
```

### 2. Configuration

Edit `.env` file with your AI service API keys:
```bash
# AI Service Keys (at least one required)
OPENAI_API_KEY=your_openai_api_key_here
ANTHROPIC_API_KEY=your_anthropic_api_key_here
GOOGLE_API_KEY=your_google_ai_api_key_here

# Email Configuration (optional)
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your_email@gmail.com
SMTP_PASSWORD=your_app_password

# Database and Logging
DATABASE_PATH=news_digest.db
LOG_LEVEL=INFO
```

### 3. Launch Web Interface

```bash
# Start the modern web interface
python main.py web

# Open your browser to: http://localhost:5000
```

### 4. CLI Usage

```bash
# First-time setup
python main.py setup

# Create a new user
python main.py user add john@example.com --id john_doe

# Run complete pipeline for a user
python main.py run john_doe

# Generate digest preview
python main.py preview john_doe

# Send email digest (quick send)
python main.py send john_doe
```

## 🌐 Web Interface Guide

### 🏠 Dashboard
- **Quick Actions**: Create users, run operations, manage users, refresh data
- **User Cards**: Visual display of all users with their preferences and status
- **Statistics**: Real-time counts of users, articles, and recent activity
- **Direct Actions**: View digests, preview emails, send emails with one click

### ⚙️ Operations Dashboard
- **Run Pipeline**: Execute full news processing with configurable options
  - Daily/Weekly digest modes
  - Enhanced AI processing
  - Dry run preview
  - Skip AI on rate limits
  - Custom article limits
- **Send Emails**: Instant email delivery to users
- **System Status**: Live statistics and health monitoring
- **Background Processing**: Long-running tasks with progress tracking

### 👥 User Management
- **User Directory**: Searchable table with all user information
- **Bulk Operations**: Export, bulk email, mass operations
- **Individual Actions**: View, edit, delete, send per user
- **CSV Export**: Download user data with categories and preferences
- **Real-time Search**: Filter users by ID or email instantly

### ➕ User Creation
- **Interactive Form**: Beautiful category selection with visual icons
- **Validation**: Real-time form validation with error messages
- **Category Selection**: Multi-select from 10 predefined categories
- **Mobile Optimized**: Touch-friendly interface for all devices

## 📋 Commands Reference

### Web Interface Routes
```
http://localhost:5000/                 # Main dashboard
http://localhost:5000/operations       # Operations dashboard  
http://localhost:5000/user-management  # User management
http://localhost:5000/create-user      # Create new user
http://localhost:5000/digest/USER_ID   # View user digest
http://localhost:5000/email-preview/USER_ID  # Preview email
```

### CLI Commands

#### Main Commands
```bash
# System setup and configuration
python main.py setup                          # First-time setup wizard
python main.py web                            # Start web interface

# Article collection & processing
python main.py collect [--articles 15]        # Collect articles from RSS feeds
python main.py process [--batch-size 50]      # Process articles with AI

# User workflows
python main.py run USER_ID [OPTIONS]          # Complete pipeline
  --articles INT          Maximum articles per feed (default: 15)
  --skip-ai              Skip AI processing

python main.py send USER_ID [OPTIONS]         # Send digest email
  --articles INT          Number of articles
  --categories TEXT       Specific categories only
  --no-collect           Use existing articles

python main.py preview USER_ID [OPTIONS]      # Preview digest
  --format [text|html]    Preview format (default: text)
  --save FILE            Save to file
  --count INT            Number of articles
```

#### User Management
```bash
# Add new user with preferences
python main.py user add EMAIL [OPTIONS]
  --id TEXT                   Custom user ID
  --count INT                 Articles per digest (default: 10)

# Update user preferences  
python main.py user edit USER_ID [OPTIONS]
  --email TEXT                Update email address
  --count INT                 Articles per digest
  --format [text|markdown|email]  Output format

# Show user details
python main.py user show USER_ID

# List all users
python main.py user list

# Remove user
python main.py user remove USER_ID [--yes]
```

#### Development Commands
```bash
# Development and debugging
python main.py dev test-email USER_ID         # Test email configuration
python main.py dev db-stats                   # Show database statistics
```

#### Quick Reference
```bash
# Common workflows
python main.py setup                          # First-time setup
python main.py user add email@domain.com      # Add user
python main.py send user_id                   # Quick send
python main.py run user_id                    # Full pipeline
python main.py web                            # Web interface

# Help and options
python main.py --help                         # Main help
python main.py COMMAND --help                 # Command-specific help
python main.py --version                      # Show version
```

## 📊 Categories System

Articles are intelligently classified into 10 categories:

1. 🔬 **Science & Discovery** - Research, scientific breakthroughs, innovations
2. 💻 **Technology & Gadgets** - Tech news, product launches, software updates
3. 🏥 **Health & Wellness** - Medical research, health tips, wellness trends
4. 💼 **Business & Finance** - Market news, business developments, economic trends
5. 🌍 **Global Affairs** - International news, politics, diplomacy
6. 🌱 **Environment & Climate** - Climate change, environmental issues, sustainability
7. 😊 **Good Vibes (Positive News)** - Uplifting stories, positive developments
8. 🎭 **Pop Culture & Lifestyle** - Entertainment, culture, lifestyle trends
9. 🎓 **For Young Minds** - Educational content, youth-focused news
10. 🔧 **DIY, Skills & How-To** - Tutorials, skill development, guides

## 🏗️ Architecture

### Two-Module Design

#### 🔄 Collector Module
- **RSS Feed Processing**: Fetches from 50+ curated sources
- **Incremental Updates**: Smart caching with HTTP ETags and Last-Modified headers
- **AI Processing**: Multi-provider classification and summarization with fallbacks
- **Deduplication**: Advanced content hashing and similarity detection
- **Trend Detection**: Cross-article analysis for emerging topics
- **Database Storage**: Enriched articles with metadata and classifications

#### 👤 User Interface Module
- **Preference Management**: Category selection, digest frequency, output formats
- **Personalization Engine**: AI-driven article selection based on user preferences
- **Multi-format Output**: Text, Markdown, HTML, and email-ready formats
- **Feedback Loop**: User ratings for continuous improvement
- **Web Interface**: Modern dashboard for visual management

### 🗄️ Database Schema

#### Articles Table
```sql
- id, title, author, publication_date, source_link
- original_summary, ai_summary, ai_categories (JSON)
- trending_flag, date_collected, content_hash
- title_hash, guid, etag, last_modified
```

#### User Preferences Table
```sql
- user_id, email, selected_categories (JSON)
- digest_frequency, articles_per_digest
- preferred_output_format, feedback_history (JSON)
- created_at, last_digest_sent
```

#### Daily One-liners Table
```sql
- id, category, generation_date
- one_liners (JSON), usage_count
- created_at
```

#### Email Deliveries Table
```sql
- id, user_id, email_address, subject_line
- template_used, delivery_status, sent_at
- open_count, click_count
```

## 🛠️ Development

### Project Structure
```
my_custom_news_app/
├── src/                           # Source code
│   ├── web_interface.py          # Modern web interface
│   ├── database.py               # Database operations  
│   ├── collector.py              # RSS collection
│   ├── ai_processor.py           # AI processing
│   ├── enhanced_ai_processor.py  # Advanced AI with multi-provider
│   ├── user_interface.py         # User management
│   ├── email_delivery.py         # Email system
│   ├── oneliner_service.py       # Daily insights generation
│   ├── ai_adapters.py            # Multi-AI provider support
│   └── enhanced_email_templates.py # Modern email templates
├── templates/                     # Web interface templates
│   ├── base.html                 # Base template with modern design
│   ├── home.html                 # Dashboard
│   ├── operations.html           # Operations dashboard
│   ├── user_management.html      # User management
│   ├── create_user.html          # User creation form
│   ├── digest.html               # Digest viewing
│   └── error.html                # Error handling
├── tests/                        # Comprehensive test suite
├── static/                       # Static assets
├── main.py                       # CLI entry point
├── config.py                     # Configuration
├── requirements.txt              # Dependencies
└── .env.example                  # Environment template
```

### Running Tests
```bash
# Run all tests
pytest tests/ -v

# Run with coverage
pytest tests/ --cov=src --cov-report=html

# Test specific components
pytest tests/test_web_interface.py -v
pytest tests/test_enhanced_ai_processor.py -v
```

### Adding New Features

#### Adding RSS Feeds
Edit `config.py` and add feeds to the appropriate category:
```python
RSS_FEEDS = {
    "Technology & Gadgets": [
        "https://new-tech-site.com/feed.xml",
        # ... existing feeds
    ]
}
```

#### Adding AI Providers
Create a new adapter in `ai_adapters.py`:
```python
class NewAIAdapter(AIAdapter):
    def classify_article(self, title: str, summary: str) -> AIResponse:
        # Implementation
        pass
```

#### Customizing Email Templates
Modify `enhanced_email_templates.py` or add new templates:
```python
def render_email_template(template_type: str, data: Dict) -> str:
    # Add new template types
    pass
```

## 🎯 API Endpoints

### Web Interface APIs
```
GET  /                              # Dashboard
GET  /operations                    # Operations dashboard
GET  /user-management               # User management
GET  /create-user                   # User creation form
POST /create-user                   # Create new user
GET  /digest/<user_id>              # View digest
GET  /email-preview/<user_id>       # Preview email

# API Endpoints
POST /api/run-pipeline              # Run news pipeline
POST /api/send-email               # Send digest email
GET  /api/pipeline-status/<user_id> # Check pipeline status
GET  /api/debug-pipeline/<user_id>  # Debug pipeline issues
DELETE /api/delete-user/<user_id>   # Delete user account
GET  /api/stats                     # System statistics
```

## 🔧 Configuration Options

### Environment Variables
```bash
# AI Services (at least one required)
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
GOOGLE_API_KEY=AI...

# Email Configuration
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password

# Application Settings
DATABASE_PATH=news_digest.db
LOG_LEVEL=INFO
MAX_ARTICLES_PER_DIGEST=20
AI_USE_BATCH_SUMMARIES=true
AI_SUMMARY_BATCH_SIZE=8

# Web Interface
FLASK_SECRET_KEY=your-secret-key
FLASK_DEBUG=false
PORT=5000
```

### AI Model Configuration
```python
AI_MODELS = {
    'openai': {
        'default': 'gpt-3.5-turbo',
        'alternatives': ['gpt-4', 'gpt-4-turbo']
    },
    'anthropic': {
        'default': 'claude-3-haiku-20240307',
        'alternatives': ['claude-3-sonnet-20240229']
    },
    'google': {
        'default': 'gemini-2.5-flash',
        'alternatives': ['gemini-1.5-pro']
    }
}
```

## 🚨 Troubleshooting

### Common Issues

1. **Web Interface Not Loading**
   ```bash
   # Check if running from correct directory
   cd my_custom_news_app
   
   # Start web interface
   python main.py web
   
   # Verify templates directory exists
   ls templates/
   ```

2. **Pipeline Not Running**
   ```bash
   # Test with debug endpoint
   curl http://localhost:5000/api/debug-pipeline/USER_ID
   
   # Check logs in console where web interface is running
   ```

3. **Email Delivery Failures**
   ```bash
   # Test email configuration
   python main.py dev test-email USER_ID
   
   # Check SMTP settings in .env file
   ```

4. **AI Processing Errors**
   ```bash
   # Check database statistics
   python main.py dev db-stats
   
   # Check API keys in .env file
   # Verify rate limits haven't been exceeded
   ```

5. **Database Issues**
   ```bash
   # Check database statistics
   python main.py dev db-stats
   
   # Reset database (will lose data)
   rm news_digest.db
   python main.py setup  # Recreates database
   ```

### Performance Optimization

- **API Cost Optimization**: Enable batch processing with `AI_USE_BATCH_SUMMARIES=true`
- **Collection Efficiency**: Use incremental collection for faster updates
- **Database Performance**: Regular cleanup of old articles
- **Memory Usage**: Adjust batch sizes based on available RAM

## 📈 Monitoring & Analytics

### Built-in Monitoring
- **Web Dashboard**: Real-time statistics and system health
- **Email Tracking**: Delivery rates, open rates, click tracking
- **User Engagement**: Article feedback and preference trends
- **System Performance**: API usage, processing times, error rates

### Log Analysis
```bash
# Monitor logs in real-time
tail -f logs/application.log

# Search for specific issues
grep "ERROR" logs/application.log
grep "API" logs/application.log
```

## 🔐 Security Considerations

- **API Keys**: Store securely in `.env` file, never commit to version control
- **User Data**: Implement data retention policies for user preferences
- **Web Security**: Use HTTPS in production, implement CSRF protection
- **Database Security**: Regular backups, access control for production deployments

## 📝 License

This project is for educational and personal use. Please respect API usage limits and terms of service for AI providers.

## 🤝 Contributing

1. **Follow Code Standards**: Use existing patterns and conventions
2. **Add Tests**: Include tests for new functionality
3. **Update Documentation**: Keep README and docstrings current
4. **Test Thoroughly**: Verify web interface and CLI functionality
5. **Validate Feeds**: Test RSS feeds before adding to configuration

## 🎉 Latest Release Features

### Version 2.0 - Web Interface & Enhanced Processing

**🌐 Major Web Interface Launch**
- Professional glassmorphism design with modern animations
- Complete operations dashboard for pipeline management
- Advanced user management with bulk operations
- Mobile-responsive design with touch-friendly UI

**⚡ Performance Improvements**  
- 10× API cost reduction through batch processing
- Smart caching with HTTP ETags for incremental updates
- Enhanced error handling and fallback systems
- Real-time status monitoring and progress tracking

**🎨 User Experience Enhancements**
- Interactive category selection with visual feedback
- One-click email sending and digest generation
- CSV export for user data analysis
- Debug endpoints for troubleshooting

**🔧 Technical Advancements**
- Multi-AI provider support with automatic fallback
- Config-driven model selection for flexibility
- Comprehensive logging and monitoring systems
- Background processing for long-running tasks

---

🚀 **Ready to get started?** 

1. **Quick Setup**: `python main.py setup`
2. **Add User**: `python main.py user add your@email.com` 
3. **Launch Web**: `python main.py web` and open http://localhost:5000
4. **Or CLI**: `python main.py run your_user_id`